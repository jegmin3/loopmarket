<!-- ì „ì²´ ì•Œë¦¼ ê´€ë¦¬ í˜ì´ì§€ -->
<div th:fragment="content">
  <div class="container mt-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title text-center mb-4">ğŸ”” ê´€ë¦¬ì ì•Œë¦¼ ì „ì†¡</h3>

        <form id="adminAlramForm">
          <div class="mb-3">
            <label for="title" class="form-label">ì•Œë¦¼ ì œëª©</label>
            <input type="text" class="form-control" id="title" name="title" required />
          </div>

          <div class="mb-3">
            <label for="content" class="form-label">ì•Œë¦¼ ë‚´ìš©</label>
            <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
          </div>

          <div class="mb-3">
            <label for="userId" class="form-label">ëŒ€ìƒ ì‚¬ìš©ì ID (ë¹„ì›Œë‘ë©´ ì „ì²´)</label>
            <input type="number" class="form-control" id="userId" name="userId" />
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">ì•Œë¦¼ ì „ì†¡</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- ìµœê·¼ ì•Œë¦¼ ëª©ë¡ -->
  <hr class="my-5" />
  <h5>ğŸ“œ ìµœê·¼ ê´€ë¦¬ì ì•Œë¦¼ ëª©ë¡</h5>
  <div class="table-responsive">
    <table class="table table-bordered table-sm" id="adminAlramTable">
      <thead class="table-light">
        <tr>
          <th>ì œëª©</th>
          <th>ë‚´ìš©</th>
          <th>ë³´ë‚¸ì‚¬ëŒ</th>
          <th>ë°›ì€ì‚¬ëŒ</th>
          <th>ë³´ë‚¸ì‹œê°„</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- JS: ì•Œë¦¼ ì „ì†¡ -->
  <script>
	function fetchAdminAlrams() {
	  fetch("/admin/alram/list")
	    .then(res => res.json())
	    .then(list => {
	      const tbody = document.querySelector("#adminAlramTable tbody");
	      tbody.innerHTML = "";
	      list.forEach(a => {
	        const row = document.createElement("tr");
	        row.innerHTML = `
	          <td>${a.title}</td>
	          <td>${a.content}</td>
	          <td>${a.senderId ?? "ê´€ë¦¬ì"}</td>
	          <td>${a.receiverName}</td>
	          <td>${a.createdAt?.replace("T", " ").substring(0, 16) ?? "-"}</td>
	        `;
	        tbody.appendChild(row);
	      });
	    });
	}

	fetchAdminAlrams(); // ìµœì´ˆ ë¡œë“œ ì‹œ í˜¸ì¶œ
	
	// ì•Œë¦¼ í¼ ì œì¶œì‹œ
    document.getElementById("adminAlramForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const form = e.target;
      const data = {
        title: form.title.value.trim(),
        content: form.content.value.trim(),
        url: form.url.value.trim() || null,
        userId: form.userId.value.trim() ? parseInt(form.userId.value.trim()) : null
      };

      fetch("/admin/alram/send", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
        .then(response => {
          if (!response.ok) throw new Error("ì „ì†¡ ì‹¤íŒ¨");
          return response.text();
        })
        .then(result => {
          alert("ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ");
          form.reset();
        })
        .catch(err => {
          console.error("ì•Œë¦¼ ì „ì†¡ ì˜¤ë¥˜:", err);
          alert("ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
        });
    });
  </script>
</div>
