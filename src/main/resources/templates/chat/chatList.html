<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0" style="max-width: 768px; margin: 0 auto;">
    <h4 class="mb-4">ğŸ“¨ ë‚˜ì˜ ì±„íŒ…ë°©</h4>

    <!-- ì±„íŒ…ë°© ì—†ì„ ê²½ìš° ë©”ì‹œì§€ -->
    <div th:if="${chatSummaries != null and #lists.isEmpty(chatSummaries)}">
        <p class="text-muted">ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ì±„íŒ…ë°© ëª©ë¡ -->
    <div class="list-group w-100" th:if="${chatSummaries != null and !#lists.isEmpty(chatSummaries)}">
        <a th:each="summary : ${chatSummaries}"
           th:href="@{/chat/room/{id}(id=${summary.room.roomId})}"
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3 fs-6">

            <div class="d-flex flex-column">
                <!-- ë‹‰ë„¤ì„ -->
                <div>
                    <i class="bi bi-person-circle me-2"></i>
                    <strong th:text="${summary.opponentNickname}">ìƒëŒ€ë°©</strong>
                </div>
                <!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ -->
                <div class="text-muted small" th:text="${summary.lastMessage}">(ë©”ì‹œì§€ ì—†ìŒ)</div>
            </div>
			
<!--		   <div class="position-relative">
		       <span class="badge rounded-pill bg-danger"
		             th:if="${summary.unreadCount > 0}"
		             th:text="${summary.unreadCount > 9 ? '.' : summary.unreadCount}"
		             style="font-size: 0.8rem; position: absolute; top: -5px; right: -10px;">
		       </span>
		   </div>-->
			
   			<!-- ì±„íŒ…ë°© ëª©ë¡ ìš°ì¸¡ì— ì±„íŒ…ì˜¨ ê°œìˆ˜(ë±ƒì§€) -->
		   <div class="text-end" style="min-width: 60px;">
		       <!-- badge ì¶”ê°€ -->
		       <span class="badge rounded-pill bg-danger"
		             th:id="'chat-badge-' + ${summary.room.roomId}"
		             style="font-size: 0.8rem; display: none;">
		           <!-- JSì—ì„œ ìˆ«ì ì‚½ì… -->
		       </span><br/>
    			<!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°„ -->
		       <small class="text-muted" th:if="${summary.lastTime != null}"
		              th:text="${#temporals.format(summary.lastTime, 'MM/dd HH:mm')}">00:00</small>
		   </div>
        </a>
    </div> <!--ì±„íŒ…ë°© ëª©ë¡ ë-->
	
	<script>
	$(document).ready(function () {
	    function updateUnreadBadges() {
	        $.get("/chat/api/unread-summary", function (data) {
	            // ëª¨ë“  ë±ƒì§€ë¥¼ ì´ˆê¸°í™”
	            $("[id^=chat-badge-]").hide();

	            data.forEach(item => {
	                const badge = $("#chat-badge-" + item.roomId);
	                if (badge.length > 0 && item.count > 0) {
	                    badge.text(item.count > 9 ? "." : item.count);
	                    badge.show();
	                }
	            });
	        }).fail(function () {
	            console.error("ì±„íŒ… ì•Œë¦¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
	        });
	    }

	    // ìµœì´ˆ ì‹¤í–‰
	    updateUnreadBadges();

	    // ì£¼ê¸°ì  ê°±ì‹ (10ì´ˆ ê°„ê²©)
	    setInterval(updateUnreadBadges, 5000);
	});
	</script>

</div>
