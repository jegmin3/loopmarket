<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0" style="max-width: 768px; margin: 0 auto;">
<style>
	.chat-room-item {
	  transition: background-color 0.2s ease;
	}
	.chat-room-item:hover {
	  background-color: #f8f9fa;
	}
	.image-stack {
	    position: relative;
	    width: 52px; /* ì´ë¯¸ì§€ ì»¤ì¡Œìœ¼ë‹ˆ ì•½ê°„ ì—¬ìœ  */
	    height: 52px;
	    margin-right: 1rem;
	}

	/* ê³µí†µ ìŠ¤íƒ€ì¼ */
	.image-stack img {
	    position: absolute;
	    object-fit: cover;
	    border: 2px solid #dee2e6;
	    transition: transform 0.25s ease, z-index 0.25s ease;
	    cursor: pointer;
	}

	/* í”„ë¡œí•„ ì´ë¯¸ì§€: ë‘¥ê¸€ê³  ì‘ê²Œ, ë’¤ë¡œ */
	.image-stack img.profile {
	    top: 0;
	    left: 0;
	    width: 36px;
	    height: 36px;
	    border-radius: 50%;
	    z-index: 1;
	}

	/* ìƒí’ˆ ì´ë¯¸ì§€: ë„¤ëª¨, ë” í¬ê³  ì•ìœ¼ë¡œ */
	.image-stack img.product {
	    bottom: 0;
	    right: 0;
	    width: 40px; /* ì•½ê°„ í¬ê²Œ */
		border-radius: 10px;
	    height: 40px;
	    opacity: 0.95;
	    z-index: 2;
	}

	/* hover ì‹œ ê°•ì¡° */
	.image-stack img:hover {
	    transform: scale(1.15);
	    z-index: 3;
	    box-shadow: 0 0 6px rgba(0,0,0,0.2);
	}

</style>
    <h4 class="mb-4">ğŸ“¨ ë‚˜ì˜ ì±„íŒ…ë°©</h4>

    <!-- ì±„íŒ…ë°© ì—†ì„ ê²½ìš° -->
	<div th:if="${chatSummaries != null and #lists.isEmpty(chatSummaries)}" class="text-center text-muted mt-5">
	     <i class="bi bi-chat-dots fs-2 d-block mb-2"></i>
	     <p>ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
	</div>

    <!-- ì±„íŒ…ë°© ëª©ë¡ -->
	<div class="list-group w-100" th:if="${chatSummaries != null and !#lists.isEmpty(chatSummaries)}">
	    <a th:each="summary : ${chatSummaries}"
	       th:href="@{/chat/room/{id}(id=${summary.room.roomId})}"
	       class="list-group-item list-group-item-action py-3 d-flex align-items-center chat-room-item">
			
		   <!-- í”„ë¡œí•„, ìƒí’ˆì´ë¯¸ì§€ ê²¹ì¹˜ê¸° -->
		   <div class="image-stack">
		       <img th:src="${summary.thumbnailPath}" alt="ìƒí’ˆì •ë³´" class="product" />
		       <img th:src="${summary.profileImagePath}" alt="í”„ë¡œí•„" class="profile" />
		   </div>

           <!-- ë‚´ìš© -->
		   <div class="flex-grow-1">
		       <div class="d-flex justify-content-between align-items-center">
		           <!-- ë‹‰ë„¤ì„ + ìƒí’ˆëª… -->
		           <strong class="text-dark">
		               <span th:text="${summary.opponentNickname}">ìƒëŒ€ë°©</span>
		               [<span th:text="${summary.pdTitle}">ìƒí’ˆ ì •ë³´</span>]
		           </strong>
		       </div>
		       <!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ -->
		       <div class="text-muted small text-truncate mt-1"
		            th:id="'chat-msg-' + ${summary.room.roomId}"
		            style="max-width: 100%;"
		            th:text="${summary.lastMessage}">(ë©”ì‹œì§€ ì—†ìŒ)</div>
		   </div>
		   <!-- ë±ƒì§€ -->
		   <span class="badge rounded-pill bg-danger ms-3 me-2"
		         th:id="'chat-badge-' + ${summary.room.roomId}"
		         style="font-size: 0.75rem; display: none;">
		   </span>

		   <!-- ë§ˆì§€ë§‰ ì‹œê°„ -->
		   <small class="text-muted"
		          th:if="${summary.lastTime != null}"
		          th:id="'chat-time-' + ${summary.room.roomId}"
		          th:text="${#temporals.format(summary.lastTime, 'MM/dd HH:mm')}">00:00</small>
        </a>
    </div>

    <!-- JS: ì•ˆ ë°”ê¿”ë„ ë¨ -->
    <script>
    $(document).ready(function () {
        function updateUnreadBadgesAndMessages() {
            $.get("/api/chat/unread-summary", function (data) {
                data.forEach(item => {
                    const badge = $("#chat-badge-" + item.roomId);
                    const msgBox = $("#chat-msg-" + item.roomId);
                    const timeBox = $("#chat-time-" + item.roomId);

                    if (item.unreadCount > 0) {
                        badge.text(item.unreadCount > 9 ? "10+" : item.unreadCount).show();
                    } else {
                        badge.hide();
                    }

                    if (msgBox.length > 0) {
                        msgBox.text(item.lastMessage || "(ë©”ì‹œì§€ ì—†ìŒ)");
                    }
                    if (timeBox.length > 0 && item.lastTime) {
						const date = item.lastTime.substring(5, 10);
						const time = item.lastTime.substring(11, 16);
						timeBox.text(date.replace("-", "/") + " " + time); // "06/11 14:23" <- ã…‡ã…£ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥ì¤‘
                    }
                });
            });
        }
        updateUnreadBadgesAndMessages();
        setInterval(updateUnreadBadgesAndMessages, 4000);
    });
    </script>
</div>
