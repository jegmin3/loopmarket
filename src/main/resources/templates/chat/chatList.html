<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0" style="max-width: 768px; margin: 0 auto;">
    <h4 class="mb-4">ğŸ“¨ ë‚˜ì˜ ì±„íŒ…ë°©</h4>

    <!-- ì±„íŒ…ë°© ì—†ì„ ê²½ìš° ë©”ì‹œì§€ -->
    <div th:if="${chatSummaries != null and #lists.isEmpty(chatSummaries)}">
        <p class="text-muted">ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ì±„íŒ…ë°© ëª©ë¡ -->
    <div class="list-group w-100" th:if="${chatSummaries != null and !#lists.isEmpty(chatSummaries)}">
        <a th:each="summary : ${chatSummaries}"
           th:href="@{/chat/room/{id}(id=${summary.room.roomId})}"
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3 fs-6">

            <div class="d-flex flex-column">
                <!-- ë‹‰ë„¤ì„ -->
                <div>
                    <i class="bi bi-person-circle me-2"></i>
                    <strong th:text="${summary.opponentNickname}">ìƒëŒ€ë°©</strong>
                </div>
                <!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ -->
                <div class="text-muted small" th:id="'chat-msg-' + ${summary.room.roomId}" th:text="${summary.lastMessage}">(ë©”ì‹œì§€ ì—†ìŒ)</div>
            </div>
			
   			<!-- ì±„íŒ…ë°© ëª©ë¡ ìš°ì¸¡ì— ì±„íŒ…ì˜¨ ê°œìˆ˜(ë±ƒì§€) -->
		   <div class="text-end" style="min-width: 60px;">
		       <!-- badge ì¶”ê°€ -->
		       <span class="badge rounded-pill bg-danger"
		             th:id="'chat-badge-' + ${summary.room.roomId}"
		             style="font-size: 0.8rem; display: none;">
		           <!-- JSì—ì„œ ìˆ«ì ì‚½ì… -->
		       </span><br/>
    			<!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°„ -->
		       <small class="text-muted" th:if="${summary.lastTime != null}" th:id="'chat-time-' + ${summary.room.roomId}"
		              th:text="${#temporals.format(summary.lastTime, 'MM/dd HH:mm')}">00:00</small>
		   </div>
        </a>
    </div> <!--ì±„íŒ…ë°© ëª©ë¡ ë-->
	
	<script>
	$(document).ready(function () {
		function updateUnreadBadgesAndMessages() {
		    $.get("/chat/api/unread-summary", function (data) {
		        data.forEach(item => {
		            const badge = $("#chat-badge-" + item.roomId);
		            const msgBox = $("#chat-msg-" + item.roomId);
		            const timeBox = $("#chat-time-" + item.roomId);

		            // ë±ƒì§€ í‘œì‹œ
		            if (item.unreadCount > 0) {
		                badge.text(item.unreadCount > 9 ? "." : item.unreadCount).show();
		            } else {
		                badge.hide();
		            }

		            // ë©”ì‹œì§€ ë‚´ìš©, ì‹œê°„ ì—…ë°ì´íŠ¸
		            if (msgBox.length > 0) {
		                msgBox.text(item.lastMessage || "(ë©”ì‹œì§€ ì—†ìŒ)");
		            }
		            if (timeBox.length > 0 && item.lastTime) {
		                const hhmm = item.lastTime.substring(11, 16); // "2025-06-04T17:21" â†’ "17:21"
		                timeBox.text(hhmm);
		            }
		        });
		    });
		}
	    // chatList ì§„ì…ì‹œ ìµœì´ˆ ì‹¤í–‰
	    updateUnreadBadgesAndMessages();
	    // ì£¼ê¸°ì ìœ¼ë¡œ ê°±ì‹ 
	    setInterval(updateUnreadBadgesAndMessages, 4000);
	});
	</script>

</div>
