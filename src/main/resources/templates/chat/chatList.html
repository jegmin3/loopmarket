<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0" style="max-width: 768px; margin: 0 auto;">
<style>
	.chat-room-item {
	  transition: background-color 0.2s ease;
	}
	.chat-room-item:hover {
	  background-color: #f8f9fa;
	}

	.chat-room-item img {
	  border: 2px solid #dee2e6;
	  transition: transform 0.2s ease;
	}
	.chat-room-item:hover img {
	  transform: scale(1.05);
	}
</style>
    <h4 class="mb-4">ğŸ“¨ ë‚˜ì˜ ì±„íŒ…ë°©</h4>

    <!-- ì±„íŒ…ë°© ì—†ì„ ê²½ìš° -->
    <div th:if="${chatSummaries != null and #lists.isEmpty(chatSummaries)}" class="text-center text-muted mt-5">
        <i class="bi bi-chat-dots fs-2 d-block mb-2"></i>
        <p>ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ì±„íŒ…ë°© ëª©ë¡ -->
    <div class="list-group w-100" th:if="${chatSummaries != null and !#lists.isEmpty(chatSummaries)}">
        <a th:each="summary : ${chatSummaries}"
           th:href="@{/chat/room/{id}(id=${summary.room.roomId})}"
           class="list-group-item list-group-item-action py-3 d-flex align-items-center chat-room-item">

           <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
		   <img th:src="${summary.profileImagePath}"
               alt="í”„ë¡œí•„"
               class="rounded-circle border me-3"
               style="width: 40px; height: 40px; object-fit: cover;" />

           <!-- ë‚´ìš© -->
           <div class="flex-grow-1">
               <div class="d-flex justify-content-between align-items-center">
                   <!-- ë‹‰ë„¤ì„ -->
                   <strong class="text-dark" th:text="${summary.opponentNickname}">ìƒëŒ€ë°©</strong>
               </div>
               <!--  ë§ˆì§€ë§‰ ë©”ì‹œì§€ ë‚´ìš© -->
               <div class="text-muted small text-truncate mt-1"
                    th:id="'chat-msg-' + ${summary.room.roomId}"
                    style="max-width: 100%;"
                    th:text="${summary.lastMessage}">(ë©”ì‹œì§€ ì—†ìŒ)</div>
           </div>
           <!-- ë±ƒì§€ -->
           <span class="badge rounded-pill bg-danger ms-3 me-2"
                 th:id="'chat-badge-' + ${summary.room.roomId}"
                 style="font-size: 0.75rem; display: none;">
               <!-- JSì—ì„œ ì±„ì›Œì§ -->
           </span>
		   <!-- ë§ˆì§€ë§‰ ì‹œê°„ -->
		   <small class="text-muted"
		          th:if="${summary.lastTime != null}"
		          th:id="'chat-time-' + ${summary.room.roomId}"
		          th:text="${#temporals.format(summary.lastTime, 'MM/dd HH:mm')}">00:00</small>
        </a>
    </div>

    <!-- JS: ì•ˆ ë°”ê¿”ë„ ë¨ -->
    <script>
    $(document).ready(function () {
        function updateUnreadBadgesAndMessages() {
            $.get("/chat/api/unread-summary", function (data) {
                data.forEach(item => {
                    const badge = $("#chat-badge-" + item.roomId);
                    const msgBox = $("#chat-msg-" + item.roomId);
                    const timeBox = $("#chat-time-" + item.roomId);

                    if (item.unreadCount > 0) {
                        badge.text(item.unreadCount > 9 ? "10+" : item.unreadCount).show();
                    } else {
                        badge.hide();
                    }

                    if (msgBox.length > 0) {
                        msgBox.text(item.lastMessage || "(ë©”ì‹œì§€ ì—†ìŒ)");
                    }
                    if (timeBox.length > 0 && item.lastTime) {
						const date = item.lastTime.substring(5, 10);
						const time = item.lastTime.substring(11, 16);
						timeBox.text(date.replace("-", "/") + " " + time); // "06/11 14:23" <- ã…‡ã…£ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥ì¤‘
                    }
                });
            });
        }
        updateUnreadBadgesAndMessages();
        setInterval(updateUnreadBadgesAndMessages, 4000);
    });
    </script>
</div>
