<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0 mx-auto"
	style="max-width: 768px;">
	<style>
		#chatArea::-webkit-scrollbar {
			width: 6px;
		}

		#chatArea::-webkit-scrollbar-thumb {
			background-color: rgba(0, 0, 0, 0.1);
			border-radius: 4px;
		}
	</style>
	<h4 class="mb-4 text-center">
		ğŸ’¬ <span th:text="${targetNickname}" class="fw-bold">ìƒëŒ€ë°© ë‹‰ë„¤ì„</span> ë‹˜ê³¼ì˜ ì±„íŒ…
	</h4>
	<!-- ìƒí’ˆ ë¯¸ë¦¬ë³´ê¸° ì¹´ë“œ -->
	<div class="card mb-3 shadow-sm w-100 border-0">
		<div class="row g-0 align-items-center">
			<div class="col-4 col-sm-3">
				<!-- ìƒí’ˆ ì´ë¯¸ì§€: ë°˜ì‘í˜• & ì •ì‚¬ê°í˜• ìœ ì§€ -->
				<img th:src="${productImagePath}" alt="ìƒí’ˆ ì´ë¯¸ì§€" class="img-fluid rounded-start"
					style="width: 100%; object-fit: cover; aspect-ratio: 1/1;" />
			</div>
			<!-- ìƒí’ˆ ì •ë³´ -->
			<div class="col-8 col-sm-9">
				<div class="card-body py-3 px-3">
					<h6 class="card-title mb-2 text-truncate fw-semibold" th:text="${product.title}">ìƒí’ˆ ì œëª©</h6>
					<p class="text-muted mb-2" style="font-size: 0.95rem;">
						â‚©<span th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')}">0</span>
					</p>
					<p class="mb-2 small">
						<span th:if="${product.isDirect}" class="badge bg-primary me-1">ì§ê±°ë˜</span>
						<span th:if="${product.isDelivery}" class="badge bg-success me-1">íƒë°°</span>
						<span th:if="${product.isNonface}" class="badge bg-secondary">ë¹„ëŒ€ë©´</span>
					</p>
					<a th:href="@{/products/{id}(id=${product.productId})}" class="btn btn-sm btn-outline-primary">
						ìƒí’ˆ í˜ì´ì§€ë¡œ ì´ë™
					</a>
				</div>
			</div>
		</div>
	</div>

	<!-- ëª©ë¡, ë‚˜ê°€ê¸° ë²„íŠ¼ div -->
	<div class="btn-group d-flex mt-4 mb-3 w-100">
		<!-- ì±„íŒ…ë°© ëª©ë¡ ì´ë™ ë²„íŠ¼ -->
		<a th:href="@{/chat/list}" class="btn btn-primary btn-sm">
			<i class="bi bi-chat-dots"></i> ì±„íŒ… ëª©ë¡ìœ¼ë¡œ
		</a>
		<!-- ì±„íŒ…ë°© ë‚˜ê°€ê¸° ë²„íŠ¼ -->
		<button id="leaveBtn" class="btn btn-danger btn-sm">ì±„íŒ…ë°© ë‚˜ê°€ê¸°</button>
		<form id="leaveForm" th:action="@{/chat/leave}" method="post" style="display: none;">
			<input type="hidden" name="roomId" th:value="${roomId}" />
		</form>
	</div>

	<!-- ë©”ì‹œì§€ ì¶œë ¥ ì˜ì—­ -->
	<div id="chatArea" class="border p-3 rounded w-100"
		style="height: 400px; background-color: #f9f9f9; overflow-y: auto;">
		<div th:each="msg : ${messageList}" class="mb-3">

			<!-- ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ -->
			<div th:if="${msg.senderId == session.loginUser.userId}" class="text-end">
				<div class="d-inline-block px-3 py-2 text-white bg-primary rounded-3 shadow-sm" style="max-width: 80%;">
					<span th:text="${msg.content}" style="font-size: 1.05rem;"></span>
				</div>
				<div class="text-end text-secondary mt-1" style="font-size: 0.75rem;">
					<span th:text="${#temporals.format(msg.sentAt, 'HH:mm')}">00:00</span>
					<!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ì¸ ê²½ìš°ì—ë§Œ ì½ìŒ ì—¬ë¶€ í‘œì‹œ -->
					<span th:if="${msg.msgId == lastMyMsgId}" th:text="${msg.read ? 'ì½ìŒ' : 'ì•ˆì½ìŒ'}"></span>
				</div>
			</div>

			<!-- ìƒëŒ€ë°©ì´ ë³´ë‚¸ ë©”ì‹œì§€ -->
			<div th:if="${msg.senderId != session.loginUser.userId}" class="text-start">
				<div class="d-inline-block px-3 py-2 bg-light border rounded-3 shadow-sm" style="max-width: 80%;">
					<span th:text="${msg.content}" style="font-size: 1.05rem;"></span>
				</div>
				<div class="text-start text-muted mt-1" style="font-size: 0.75rem;">
					<span th:text="${#temporals.format(msg.sentAt, 'HH:mm')}">00:00</span>
				</div>
			</div>

		</div>
	</div>

	<!-- ì…ë ¥ì°½ -->
	<form id="chatForm" class="mt-3 d-flex w-100">
		<input type="text" id="msgInput" class="form-control me-2 rounded-pill" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
		<button type="submit" class="btn btn-success rounded-pill px-4" style="white-space: nowrap;">
			ì „ì†¡
		</button>
	</form>

	<!-- chatRoom.jsìš© ì „ì—­ë³€ìˆ˜ ì„¤ì • -->
	<script th:inline="javascript">
		window.roomId = /*[[${roomId}]]*/ null;
		window.senderId = /*[[${session.loginUser.userId}]]*/ 0;
		window.targetId = /*[[${targetId}]]*/ 0;
		window.productId = /*[[${product.productId}]]*/ 0;
		//ì´ë¯¸ ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹¤ì‹œ ë Œë”ë§í•˜ì§€ ì•Šë„ë¡
		// shownMessageIdsë¥¼ ìˆ˜ë™ìœ¼ë¡œ ëª¨ì•„ì„œ ë³´ë‚´ê¸° (map ëŒ€ì‹  each)
		window.shownMessageIds = [
			/*[# th:each="msg : ${messageList}"]*/
				/*[[${msg.msgId}]]*/,
			/*[/]*/
		];
	</script>

</div>