<div th:fragment="searchAndLocation">
  <div class="search-section container">
    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼ ì—°ê²° (index.css) -->
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <!-- ìœ„ì¹˜ + ê²€ìƒ‰ì–´ ë¬¸ì¥ -->
    <!-- ì¡°ê±´ë¶€ë¡œ ë³´ì—¬ì¤„ ì œëª© -->
    <h2 class="search-title mb-5 text-center" th:if="${showSearchTitle}">
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
           class="bi bi-geo-alt-fill me-1" viewBox="0 0 16 16" style="vertical-align: middle;">
        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
      </svg>
      <span id="location-title">ìƒë´‰ë™</span>ì—ì„œ
      <span id="rotating-keyword">ì•„ì´í°</span> ì°¾ê³  ê³„ì‹ ê°€ìš”?
    </h2>







    <!-- ìœ„ì¹˜ ë²„íŠ¼ + ê²€ìƒ‰ì°½ í•œ ì¤„ ì •ë ¬ -->
    <div class="d-flex justify-content-center align-items-center gap-2 flex-wrap mt-4">
      <!-- ìœ„ë„/ê²½ë„ íŒŒë¼ë¯¸í„° ìœ ì§€ìš© -->
      <input type="hidden" id="latitude" th:value="${param.lat}" />
      <input type="hidden" id="longitude" th:value="${param.lng}" />

      <!-- ìœ„ì¹˜ ë³€ê²½ ë²„íŠ¼ -->
      <button id="location-btn"
              class="location-btn rounded-pill px-4 py-2"
              type="button"
              data-bs-toggle="modal" data-bs-target="#locationModal">
        <span id="current-location">ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...</span>
      </button>

      <!-- ê²€ìƒ‰ ì…ë ¥ì°½ -->
      <form class="d-flex align-items-center search-wrapper" method="get" th:action="@{/products}">
        <input type="text" name="search" class="search-input"
               placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
               th:value="${param.search}" />
        <button type="submit" class="search-btn">
          <!-- ê²€ìƒ‰ ì•„ì´ì½˜ (â†’ ëª¨ì–‘) -->
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
          </svg>
        </button>
      </form>
    </div>
  </div>

  <!-- ìœ„ì¹˜ ì„ íƒ ëª¨ë‹¬ -->
  <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="locationModalLabel">ì§€ì—­ ë³€ê²½</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>

        <div class="modal-body" style="height: 500px; display: flex; flex-direction: column; overflow-y: hidden;">
          <!-- ë™ë„¤ ê²€ìƒ‰ì°½ -->
          <div class="input-group mb-3">
            <input type="text" id="locationSearchInput"
                   class="form-control"
                   placeholder="ì§€ì—­ì´ë‚˜ ë™ë„¤ë¡œ ê²€ìƒ‰í•˜ê¸°"
                   oninput="searchOrFilterLocation()"
                   onkeyup="handleLocationKey(event)">
            <button class="btn btn-outline-secondary" type="button" onclick="searchOrFilterLocation()">ğŸ”</button>
          </div>

          <!-- í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ -->
          <div class="text-center mb-3">
            <button class="btn btn-outline-danger" onclick="getLocation()">ğŸ“ í˜„ì¬ ë‚´ ìœ„ì¹˜ ì‚¬ìš©í•˜ê¸°</button>
          </div>

          <!-- ì¶”ì²œ + ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
          <div style="flex: 1; overflow-y: auto;">
            <div id="recommendSection" class="mb-3">
              <div class="fw-bold text-primary">ì¶”ì²œ</div>
              <ul class="list-group" id="locationList">
                <li class="list-group-item location-option"
                    th:each="dong : ${recommendedDongNames}"
                    th:text="${dong}"
                    th:attr="data-location=${dong}"
                    onclick="setLocation(this.dataset.location)">
                </li>
              </ul>
            </div>

            <!-- ë™ë„¤ ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ (ê²€ìƒ‰ ì‹œì—ë§Œ ë³´ì—¬ì§) -->
            <ul id="searchResultList" class="list-group d-none"
                style="min-height: 250px; max-height: 300px; overflow-y: auto;"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê²€ìƒ‰ì–´ ìë™ ìˆœí™˜ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log("rotateKeyword ë™ì‘í•¨");
      const rotatingWords = ["ì•„ì´í°", "ì•„ì´íŒ¨ë“œ", "ì—ì–´íŒŸ", "ë…¸íŠ¸ë¶", "ê°¤ëŸ­ì‹œ", "ë‹Œí…ë„","ë³¸ì²´","í—¤ë“œì…‹","ë§ˆìš°ìŠ¤","ì¹´ë©”ë¼"];
      let currentIndex = 0;

      function rotateKeyword() {
        const keywordEl = document.getElementById("rotating-keyword");
        if (!keywordEl) return;

        // í…ìŠ¤íŠ¸ ë°”ê¾¸ê³  animation í´ë˜ìŠ¤ ì¬ì ìš©
        keywordEl.classList.remove("animated-keyword"); // ì´ˆê¸°í™”
        void keywordEl.offsetWidth; // DOM ë¦¬ë Œë”ë§ íŠ¸ë¦­
        keywordEl.textContent = rotatingWords[currentIndex];
        keywordEl.classList.add("animated-keyword");

        currentIndex = (currentIndex + 1) % rotatingWords.length;
      }

      rotateKeyword(); // ìµœì´ˆ ì‹¤í–‰
      setInterval(rotateKeyword, 2000); // ë°˜ë³µ ì‹¤í–‰
    });

  </script>

</div>

<!-- ì™¸ë¶€ CSS (product.cssì— ê²€ìƒ‰ì°½, ë²„íŠ¼ ë“± í¬í•¨ë¨) -->
<link rel="stylesheet" th:href="@{/css/product.css}" />
<link rel="stylesheet" th:href="@{/css/index.css}" />
<!-- ë©”ì¸ ì½˜í…ì¸  Fragment -->
<div th:fragment="content">

  <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼ ì—°ê²° (index.css) -->
  <link rel="stylesheet" th:href="@{/css/index.css}">

  <div class="container my-5">

    <!-- 1. ê²€ìƒ‰ì°½ ë° ìœ„ì¹˜ ì •ë³´ ì˜ì—­ (fragmentë¡œ ë¶„ë¦¬) -->
    <div th:replace="fragment/searchAndLocation :: searchAndLocation"
         th:with="showSearchTitle=${true}">
    </div>

    <!-- 2. ì¹´í…Œê³ ë¦¬ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
    <!-- í•œ ì¤„ ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ ë©”ë‰´ -->
    <div class="container my-5">
      <div class="d-flex flex-wrap justify-content-center gap-3 category-row">

        <!-- ë°˜ë³µ ë Œë”ë§: mainCategories ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° ì•„ì´ì½˜ ì¹´ë“œ ìƒì„± -->
        <div th:each="category : ${mainCategories}" class="category-icon-card text-center">
          <a href="#" class="text-decoration-none text-dark category-link"
             th:attr="data-value=${category.ctgCode}">
            <div class="icon" th:text="'ğŸ“±'"></div>
            <div class="label" th:text="${category.ctgName}">ì¹´í…Œê³ ë¦¬ëª…</div>
          </a>
        </div>


      </div>
    </div>


  </div>

  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ SDK + render.js ìŠ¤í¬ë¦½íŠ¸ -->
  <script type="text/javascript"
          src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d4ca8876da8e183543e1cfbbd669097d&libraries=services"></script>
  <script th:src="@{/js/render.js}"></script>

</div>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ ì˜ì—­ (í•„ìš” ì‹œ ë™ì ìœ¼ë¡œ ë‚´ìš© ì‚½ì…ë¨) -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" id="loginModalContent">
      <!-- ë¡œê·¸ì¸ í¼ fragmentê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë  ìë¦¬ -->
    </div>
  </div>
</div>

