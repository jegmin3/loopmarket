<style>
  .search-btn svg {
    vertical-align: middle;
    display: inline-block;
  }
  .search-btn {
    width: 44px;
    height: 44px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

</style>
<div th:fragment="searchAndLocation">
  <div class="container my-5 text-center">

    <!-- ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰ ì œëª© -->
    <h2 class="mb-3" th:if="${showSearchTitle}">ğŸ“
      <span id="location-title">ìƒë´‰ë™</span>ì—ì„œ
      <span th:text="${param.search ?: 'ì•„ì´í°'}"></span> ì°¾ê³  ê³„ì‹ ê°€ìš”?
    </h2>

    <!-- ìœ„ì¹˜ + ê²€ìƒ‰ì°½ í•œ ì¤„ë¡œ ì •ë ¬ -->
    <div class="d-flex justify-content-center align-items-center gap-2 flex-wrap mt-4">
      <input type="hidden" id="latitude" th:value="${param.lat}" />
      <input type="hidden" id="longitude" th:value="${param.lng}" />

      <!-- ìœ„ì¹˜ ë³€ê²½ ë²„íŠ¼ (ëª¨ë‹¬ ì—´ê¸°) -->
      <button id="location-btn"
              class="location-btn rounded-pill px-4 py-2"
              type="button"
              data-bs-toggle="modal" data-bs-target="#locationModal">
        <span id="current-location">ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...</span>
      </button>


      <!-- ê²€ìƒ‰ ì…ë ¥ì°½ + ë²„íŠ¼ ë¬¶ìŒ -->
      <form class="d-flex align-items-center search-wrapper" method="get" th:action="@{/products}">
        <input type="text" name="search" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" th:value="${param.search}" />
        <button type="submit" class="search-btn">
          <!-- SVG ì•„ì´ì½˜ ì‚½ì… -->
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
          </svg>
        </button>
      </form>





    </div> <!-- ì—¬ê¸°ì— ì •ë ¬ div ë‹«í˜ -->

  </div> <!--  container ë‹«í˜ ìœ„ì¹˜ë„ ëª…í™• -->

  <!-- ìœ„ì¹˜ ë³€ê²½ìš© ëª¨ë‹¬ì°½ -->
  <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="locationModalLabel">ì§€ì—­ ë³€ê²½</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body" style="height: 500px; display: flex; flex-direction: column; overflow-y: hidden;">
          <div class="input-group mb-3">
            <input type="text" id="locationSearchInput"
                   class="form-control"
                   placeholder="ì§€ì—­ì´ë‚˜ ë™ë„¤ë¡œ ê²€ìƒ‰í•˜ê¸°"
                   oninput="searchOrFilterLocation()"
                   onkeyup="handleLocationKey(event)">
            <button class="btn btn-outline-secondary" type="button" onclick="searchOrFilterLocation()">ğŸ”</button>
          </div>
          <div class="text-center mb-3">
            <button class="btn btn-outline-danger" onclick="getLocation()">ğŸ“ í˜„ì¬ ë‚´ ìœ„ì¹˜ ì‚¬ìš©í•˜ê¸°</button>
          </div>
          <div style="flex: 1; overflow-y: auto;">
            <div id="recommendSection" class="mb-3">
              <div class="fw-bold text-primary">ì¶”ì²œ</div>
              <ul class="list-group" id="locationList">
                <li class="list-group-item location-option"
                    th:each="dong : ${recommendedDongNames}"
                    th:text="${dong}"
                    th:attr="data-location=${dong}"
                    onclick="setLocation(this.dataset.location)">
                </li>
              </ul>
            </div>
            <ul id="searchResultList" class="list-group d-none"
                style="min-height: 250px; max-height: 300px; overflow-y: auto;"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<link rel="stylesheet" th:href="@{/css/product.css}" />
