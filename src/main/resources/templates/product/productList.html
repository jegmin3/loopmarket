<style>
  /* ì´ì „/ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ - ê¸°ë³¸ì€ íˆ¬ëª…, ì¹´ë“œ í˜¸ë²„ ì‹œ ë³´ì„ */
  .slider-prev,
  .slider-next {
    opacity: 0;
    pointer-events: none;
    color: rgba(0, 0, 0, 0.4);
    font-size: 20px;
    background: transparent;
    border: none;
    transition: opacity 0.3s ease, color 0.3s ease;
  }

  /* ì¹´ë“œì— ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ í™œì„±í™” */
  .card:hover .slider-prev,
  .card:hover .slider-next {
    opacity: 1;
    pointer-events: auto;
    color: rgba(0, 0, 0, 0.85);
  }

  /* íŒë§¤ì™„ë£Œ ìƒí’ˆìš© íšŒìƒ‰ ì˜¤ë²„ë ˆì´ */
  .sold-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(120, 120, 120, 0.4); /* íšŒìƒ‰ ë°˜íˆ¬ëª… */
    z-index: 2;
  }
</style>

<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<div th:fragment="content">


  <div class="container my-5">
    <h2 class="mb-4 text-center">ğŸ“¦ ì „ì²´ ìƒí’ˆ ëª©ë¡</h2>
    <div class="mt-3">
      <button id="locationFilterBtn" class="btn btn-primary">ğŸ“ ì´ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ë³´ê¸°</button>
      <button id="allProductBtn" class="btn btn-outline-secondary">ì „ì²´ ìƒí’ˆ ë³´ê¸°</button>

    </div>
    <!-- ê²€ìƒ‰ & ì§€ì—­ ìœ„ì¹˜ ì˜ì—­ (fragment ë¶ˆëŸ¬ì˜¤ê¸°) -->
    <div th:replace="fragment/searchAndLocation :: searchAndLocation"
         th:with="showSearchTitle=${false}"></div>



    <!-- ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ -->
    <!--
    <div class="text-end mb-3" sec:authorize="isAuthenticated()">
      <a href="/products/new" class="btn btn-primary">ìƒí’ˆ ë“±ë¡</a>
    </div>
    -->
    <!-- ì„ì‹œ: ë¡œê·¸ì¸ ì—¬ë¶€ ìƒê´€ì—†ì´ ë²„íŠ¼ í•­ìƒ í‘œì‹œ -->
    <div class="text-end mb-3">
      <a href="/products/new" class="btn btn-primary">ìƒí’ˆ ë“±ë¡</a>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
    <div class="row">
      <div class="col-md-3">
        <h5 class="mb-3"></h5>
        <div class="btn-group-vertical w-100" role="group" aria-label="ì¹´í…Œê³ ë¦¬ ì„ íƒ">
          <!-- ì „ì²´ ë²„íŠ¼ -->
          <button type="button"
                  class="btn btn-outline-secondary text-start"
                  style="width: 100%;"
                  data-value=""
                  th:classappend="${not param.containsKey('category') or #strings.isEmpty(param.category)} ? ' active'">
            ì „ì²´
          </button>

          <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ë°˜ë³µ -->
          <button type="button"
                  class="btn btn-outline-secondary text-start category-btn"
                  style="width: 100%;"
                  th:each="cat : ${mainCategories}"
                  th:data-value="${cat.ctgCode}"
                  th:text="${cat.ctgName}"
                  th:classappend="${#strings.equals(param.category, cat.ctgCode.toString())} ? ' active'">
            ì¹´í…Œê³ ë¦¬ëª…
          </button>

        </div>
        <!-- ê°€ê²© í•„í„° -->
        <!-- ê°€ê²© í•„í„° -->
        <div class="mt-4 p-3 border rounded">
          <h6 class="fw-bold mb-3">ê°€ê²©</h6>
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-secondary" onclick="filterByPrice(0, 5000)" data-min="0" data-max="5000">5,000ì› ì´í•˜</button>
            <button type="button" class="btn btn-outline-secondary" onclick="filterByPrice(0, 10000)" data-min="0" data-max="10000">10,000ì› ì´í•˜</button>
            <button type="button" class="btn btn-outline-secondary" onclick="filterByPrice(0, 20000)" data-min="0" data-max="20000">20,000ì› ì´í•˜</button>
          </div>

          <div class="mt-3 d-flex gap-2 align-items-center">
            <input type="number" class="form-control" id="minPrice" placeholder="ìµœì†Œ" min="0">
            <span>-</span>
            <input type="number" class="form-control" id="maxPrice" placeholder="ìµœëŒ€" min="0">
          </div>

          <button class="btn btn-sm btn-primary w-100 mt-2" onclick="applyPriceRange()">ì ìš©í•˜ê¸°</button>
          <button class="btn btn-sm btn-outline-danger w-100 mt-2" onclick="resetPriceFilter()">ê°€ê²© ì´ˆê¸°í™”</button> <!-- ì—¬ê¸° -->
        </div>

      </div>



      <!-- ìƒí’ˆ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
      <div class="col-md-9">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ ì¶œë ¥ -->
      <div class="col" th:each="product : ${productList}">
        <a th:href="@{'/products/' + ${product.productId}}" class="text-decoration-none text-dark">
          <div class="card h-100 shadow-sm">

            <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
            <div class="position-relative" style="height: 200px; overflow: hidden;">

              <!-- ìŠ¬ë¼ì´ë” ì´ë¯¸ì§€ ë¨¼ì € -->
              <div class="slider-track d-flex"
                   th:style="'width:' + (${#lists.size(product.imagePaths)} * 100) + '%; height: 100%; transition: transform 0.5s ease;'"
                   th:attr="data-count=${product.imagePaths.size()}">
                <img th:each="img : ${product.imagePaths}"
                     th:src="@{${img}}"
                     th:style="'width:' + (100 / ${#lists.size(product.imagePaths)}) + '%; height: 100%; object-fit: cover; flex-shrink: 0;'"/>
              </div>

              <!-- ì´ë¯¸ì§€ ìœ„ì— íšŒìƒ‰ ì˜¤ë²„ë ˆì´ (z-10) -->
              <div th:if="${product.status == 'SOLD'}"
                   class="position-absolute top-0 start-0 w-100 h-100"
                   style="background-color: rgba(120, 120, 120, 0.4); z-index: 10;"></div>

              <!-- ìƒíƒœ ë±ƒì§€ (z-20) -->
              <div class="position-absolute top-0 start-0 z-20">
                <div th:if="${product.status == 'SOLD'}"
                     class="badge bg-dark text-white rounded-end px-2 py-1 small">íŒë§¤ì™„ë£Œ</div>
                <div th:if="${product.status == 'RESERVED'}"
                     class="badge bg-warning text-dark rounded-end px-2 py-1 small">ì˜ˆì•½ì¤‘</div>
                <div th:if="${product.status == 'ONSALE'}"
                     class="badge bg-success text-white rounded-end px-2 py-1 small">íŒë§¤ì¤‘</div>
              </div>

              <button th:if="${product.imagePaths.size() > 1}"
                      class="slider-prev btn position-absolute top-50 start-0 translate-middle-y"
                      onclick="slideImage(this, -1, event)">â®</button>

              <button th:if="${product.imagePaths.size() > 1}"
                      class="slider-next btn position-absolute top-50 end-0 translate-middle-y"
                      onclick="slideImage(this, 1, event)">â¯</button>

              <div th:if="${product.imagePaths.size() > 1}"
                   class="position-absolute bottom-0 start-50 translate-middle-x d-flex gap-1 mb-1">
          <span th:each="i : ${#numbers.sequence(0, #lists.size(product.imagePaths) - 1)}"
                class="dot bg-dark rounded-circle"
                th:attr="data-index=${i}"
                style="width: 6px; height: 6px; opacity: 0.4;"></span>
              </div>
            </div>

            <!-- í…ìŠ¤íŠ¸ ì˜ì—­ -->
            <div class="card-body">
              <h5 class="card-title" th:text="${product.title}">ìƒí’ˆëª…</h5>
              <p class="card-text fw-bold" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA') + 'ì›'}">ê°€ê²©</p>
            </div>
          </div>
        </a>
      </div>

    </div>
  </div>
    </div>

    <!-- ìƒí’ˆ ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script th:src="@{/js/product.js}"></script>
    <script th:src="@{/js/render.js}"></script>
</div>
